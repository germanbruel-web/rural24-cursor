# Rural24 - Performance Diagnostics Script$ErrorActionPreference = "SilentlyContinue"Write-Host ""Write-Host "===============================================" -ForegroundColor CyanWrite-Host "  RURAL24 - Performance Diagnostic Report" -ForegroundColor WhiteWrite-Host "===============================================" -ForegroundColor CyanWrite-Host ""# Process CountWrite-Host "[1/5] Process Count" -ForegroundColor Yellow$codeProcs = Get-Process Code -ErrorAction SilentlyContinue$nodeProcs = Get-Process node -ErrorAction SilentlyContinue$codeCount = if ($codeProcs) { $codeProcs.Count } else { 0 }$nodeCount = if ($nodeProcs) { $nodeProcs.Count } else { 0 }$codeColor = if ($codeCount -lt 15) { "Green" } else { "Red" }$nodeColor = if ($nodeCount -lt 5) { "Green" } else { "Yellow" }Write-Host "  Code processes: $codeCount" -ForegroundColor $codeColorWrite-Host "  Node processes: $nodeCount" -ForegroundColor $nodeColor# RAM UsageWrite-Host ""Write-Host "[2/5] Memory Usage" -ForegroundColor Yellow$codeRam = if ($codeProcs) { ($codeProcs | Measure-Object WorkingSet64 -Sum).Sum / 1MB } else { 0 }$nodeRam = if ($nodeProcs) { ($nodeProcs | Measure-Object WorkingSet64 -Sum).Sum / 1MB } else { 0 }$totalRam = $codeRam + $nodeRam$ramColor = if ($totalRam -lt 4096) { "Green" } else { "Red" }Write-Host "  Code RAM: $([math]::Round($codeRam)) MB" -ForegroundColor $(if ($codeRam -lt 3000) { "Green" } else { "Yellow" })Write-Host "  Node RAM: $([math]::Round($nodeRam)) MB" -ForegroundColor $(if ($nodeRam -lt 1000) { "Green" } else { "Yellow" })Write-Host "  Total: $([math]::Round($totalRam)) MB" -ForegroundColor $ramColor# Top ConsumersWrite-Host ""Write-Host "[3/5] Top 5 Memory Consumers" -ForegroundColor Yellow$allProcs = @()if ($codeProcs) { $allProcs += $codeProcs }if ($nodeProcs) { $allProcs += $nodeProcs }$topProcs = $allProcs | Sort-Object WorkingSet64 -Descending | Select-Object -First 5foreach ($proc in $topProcs) {    $ramMB = [math]::Round($proc.WorkingSet64 / 1MB, 2)    Write-Host "  PID $($proc.Id): ${ramMB}MB" -ForegroundColor Gray}# ZombiesWrite-Host ""Write-Host "[4/5] Zombie Detection" -ForegroundColor Yellow$zombieThreshold = 60$now = Get-Date$zombies = @()if ($nodeProcs) {    $zombies = $nodeProcs | Where-Object {        ($now - $_.StartTime).TotalMinutes -gt $zombieThreshold    }}$zombieCount = if ($zombies) { $zombies.Count } else { 0 }if ($zombieCount -eq 0) {    Write-Host "  OK - No zombies detected" -ForegroundColor Green}else {    Write-Host "  Found $zombieCount zombie processes" -ForegroundColor Red}# Dev ServersWrite-Host ""Write-Host "[5/5] Development Servers" -ForegroundColor Yellow$frontendConn = Get-NetTCPConnection -LocalPort 5173 -State Listen -ErrorAction SilentlyContinue$backendConn = Get-NetTCPConnection -LocalPort 3001 -State Listen -ErrorAction SilentlyContinueif ($frontendConn) {    Write-Host "  Frontend (5173): RUNNING" -ForegroundColor Green}else {    Write-Host "  Frontend (5173): OFF" -ForegroundColor DarkGray}if ($backendConn) {    Write-Host "  Backend (3001): RUNNING" -ForegroundColor Green}else {    Write-Host "  Backend (3001): OFF" -ForegroundColor DarkGray}# SummaryWrite-Host ""Write-Host "===============================================" -ForegroundColor CyanWrite-Host "  SUMMARY" -ForegroundColor WhiteWrite-Host "===============================================" -ForegroundColor CyanWrite-Host ""$issues = @()$score = 100if ($codeCount -gt 15) {    $issues += "Too many Code processes: $codeCount"    $score -= 20}if ($totalRam -gt 4096) {    $issues += "High RAM usage: $([math]::Round($totalRam)) MB"    $score -= 25}if ($zombieCount -gt 0) {    $issues += "Zombie processes: $zombieCount"    $score -= 15}$scoreColor = if ($score -ge 80) { "Green" } elseif ($score -ge 60) { "Yellow" } else { "Red" }Write-Host "Performance Score: $score/100" -ForegroundColor $scoreColorWrite-Host ""if ($issues.Count -eq 0) {    Write-Host "OK - System optimized" -ForegroundColor Green}else {    Write-Host "Issues:" -ForegroundColor Yellow    foreach ($issue in $issues) {        Write-Host "  - $issue" -ForegroundColor Red    }        Write-Host ""    Write-Host "Recommendations:" -ForegroundColor Cyan    Write-Host "  * Reiniciar VS Code" -ForegroundColor Gray    Write-Host "  * Ejecutar .\cleanup-processes.ps1" -ForegroundColor Gray    Write-Host "  * Usar .\dev-optimized.ps1" -ForegroundColor Gray}Write-Host ""Write-Host "===============================================" -ForegroundColor CyanWrite-Host "Report: $(Get-Date -Format 'yyyy-MM-dd HH:mm:ss')" -ForegroundColor DarkGrayWrite-Host "===============================================" -ForegroundColor CyanWrite-Host ""