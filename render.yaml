# ============================================================================
# Render Configuration - rural24
# ============================================================================
# Docs: https://render.com/docs/yaml-spec

services:
  # Backend (Next.js)
  - type: web
    name: rural24-backend
    runtime: node
    region: oregon
    plan: free
    buildCommand: cd backend && npm install && npm run build
    startCommand: cd backend && npm start
    envVars:
      - key: NODE_ENV
        value: production
      - key: NEXT_PUBLIC_SUPABASE_URL
        sync: false
      - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: CRON_SECRET
        generateValue: true  # ⚠️ IMPORTANTE: verificar que existe en Dashboard de Render
    healthCheckPath: /api/health

  # Frontend (Vite)
  - type: web
    name: rural24-frontend
    runtime: static
    region: oregon
    plan: free
    buildCommand: cd frontend && npm install && npm run build
    staticPublishPath: frontend/dist
    envVars:
      - key: VITE_SUPABASE_URL
        sync: false
      - key: VITE_SUPABASE_ANON_KEY
        sync: false
      - key: VITE_BACKEND_URL
        value: https://rural24.onrender.com

# ============================================================================
# ============================================================================
# CRON JOBS
# ============================================================================
# ⚠️ Render free tier NO soporta cron jobs (requiere plan pago).
# El cron se ejecuta via GitHub Actions: .github/workflows/cron-featured-ads.yml
# 
# Si se upgrade a plan pago, descomentar:
#
# jobs:
#   - type: cron
#     name: featured-ads-cleanup
#     schedule: "0 * * * *"
#     buildCommand: echo "Cron job preparado"
#     startCommand: >
#       curl -X POST https://rural24.onrender.com/api/featured-ads/cron
#       -H "X-Cron-Secret: ${CRON_SECRET}"
#       -H "Content-Type: application/json"
#       --connect-timeout 60 --max-time 120 --retry 2 --retry-delay 10
#       -f -s -o /dev/null -w "HTTP %{http_code}"
#     envVars:
#       - key: CRON_SECRET
#         fromService:
#           name: rural24-backend
#           type: web
#           envVarKey: CRON_SECRET
